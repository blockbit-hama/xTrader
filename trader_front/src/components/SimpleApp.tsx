import React, { useState } from 'react';
import { useTradingAPI } from '../hooks/useTradingAPI';
import TradingViewChart from './TradingViewChart';

const SimpleApp: React.FC = () => {
  const [balance] = useState({ BTC: 1.5, KRW: 50000000 });
  const { statistics, candles, orderBook, executions, loading, error, submitOrder } = useTradingAPI('BTC-KRW');
  const currentPrice = statistics?.last_price || 50000000;

  // Î°úÎî© ÌÉÄÏûÑÏïÑÏõÉ Ï≤òÎ¶¨ (1Ï¥à ÌõÑ Í∞ïÏ†úÎ°ú mock Îç∞Ïù¥ÌÑ∞ ÌëúÏãú)
  const [showMockData, setShowMockData] = useState(true); // Ï¶âÏãú Mock Îç∞Ïù¥ÌÑ∞ ÌëúÏãú

  React.useEffect(() => {
    const timer = setTimeout(() => {
      if (loading && candles.length === 0) {
        console.log('üîÑ Î∞±ÏóîÎìú Ïó∞Í≤∞ ÌÉÄÏûÑÏïÑÏõÉ, Mock Îç∞Ïù¥ÌÑ∞ ÌëúÏãú');
        setShowMockData(true);
      }
    }, 1000); // 1Ï¥àÎ°ú Îã®Ï∂ï

    return () => clearTimeout(timer);
  }, [loading, candles.length]);

  // Mock Ï∫îÎì§ Îç∞Ïù¥ÌÑ∞ (Î∞±ÏóîÎìú Ïó∞Í≤∞ ÏïàÎê† Îïå ÌÖåÏä§Ìä∏Ïö©)
  const mockCandles = [
    { open: 48000000, high: 51000000, low: 47000000, close: 50000000, volume: 150, open_time: Date.now() - 19 * 60 * 1000, close_time: Date.now() - 19 * 60 * 1000, trade_count: 45 },
    { open: 50000000, high: 52000000, low: 49000000, close: 51000000, volume: 180, open_time: Date.now() - 18 * 60 * 1000, close_time: Date.now() - 18 * 60 * 1000, trade_count: 52 },
    { open: 51000000, high: 53000000, low: 50000000, close: 49000000, volume: 120, open_time: Date.now() - 17 * 60 * 1000, close_time: Date.now() - 17 * 60 * 1000, trade_count: 38 },
    { open: 49000000, high: 50000000, low: 47500000, close: 48500000, volume: 200, open_time: Date.now() - 16 * 60 * 1000, close_time: Date.now() - 16 * 60 * 1000, trade_count: 65 },
    { open: 48500000, high: 51000000, low: 48000000, close: 50500000, volume: 160, open_time: Date.now() - 15 * 60 * 1000, close_time: Date.now() - 15 * 60 * 1000, trade_count: 48 },
    { open: 50500000, high: 52500000, low: 50000000, close: 52000000, volume: 190, open_time: Date.now() - 14 * 60 * 1000, close_time: Date.now() - 14 * 60 * 1000, trade_count: 58 },
    { open: 52000000, high: 53000000, low: 51000000, close: 51500000, volume: 140, open_time: Date.now() - 13 * 60 * 1000, close_time: Date.now() - 13 * 60 * 1000, trade_count: 42 },
    { open: 51500000, high: 52000000, low: 49500000, close: 50000000, volume: 175, open_time: Date.now() - 12 * 60 * 1000, close_time: Date.now() - 12 * 60 * 1000, trade_count: 55 },
    { open: 50000000, high: 51500000, low: 49000000, close: 51000000, volume: 185, open_time: Date.now() - 11 * 60 * 1000, close_time: Date.now() - 11 * 60 * 1000, trade_count: 60 },
    { open: 51000000, high: 52000000, low: 50500000, close: 51800000, volume: 155, open_time: Date.now() - 10 * 60 * 1000, close_time: Date.now() - 10 * 60 * 1000, trade_count: 47 },
    { open: 51800000, high: 53500000, low: 51000000, close: 52500000, volume: 195, open_time: Date.now() - 9 * 60 * 1000, close_time: Date.now() - 9 * 60 * 1000, trade_count: 62 },
    { open: 52500000, high: 54000000, low: 52000000, close: 53000000, volume: 165, open_time: Date.now() - 8 * 60 * 1000, close_time: Date.now() - 8 * 60 * 1000, trade_count: 50 },
    { open: 53000000, high: 53500000, low: 51500000, close: 52000000, volume: 145, open_time: Date.now() - 7 * 60 * 1000, close_time: Date.now() - 7 * 60 * 1000, trade_count: 44 },
    { open: 52000000, high: 53000000, low: 51000000, close: 52800000, volume: 170, open_time: Date.now() - 6 * 60 * 1000, close_time: Date.now() - 6 * 60 * 1000, trade_count: 53 },
    { open: 52800000, high: 54000000, low: 52500000, close: 53500000, volume: 180, open_time: Date.now() - 5 * 60 * 1000, close_time: Date.now() - 5 * 60 * 1000, trade_count: 57 },
    { open: 53500000, high: 54500000, low: 53000000, close: 54000000, volume: 200, open_time: Date.now() - 4 * 60 * 1000, close_time: Date.now() - 4 * 60 * 1000, trade_count: 64 },
    { open: 54000000, high: 54200000, low: 52500000, close: 53000000, volume: 160, open_time: Date.now() - 3 * 60 * 1000, close_time: Date.now() - 3 * 60 * 1000, trade_count: 49 },
    { open: 53000000, high: 54000000, low: 52800000, close: 53800000, volume: 175, open_time: Date.now() - 2 * 60 * 1000, close_time: Date.now() - 2 * 60 * 1000, trade_count: 56 },
    { open: 53800000, high: 55000000, low: 53500000, close: 54500000, volume: 190, open_time: Date.now() - 1 * 60 * 1000, close_time: Date.now() - 1 * 60 * 1000, trade_count: 61 },
    { open: 54500000, high: 55500000, low: 54000000, close: 55000000, volume: 210, open_time: Date.now(), close_time: Date.now(), trade_count: 68 }
  ];

  // Ïã§Ï†ú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏùÑ Îïå mock Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö© (ÎòêÎäî ÌÉÄÏûÑÏïÑÏõÉ Ïãú)
  const chartCandles = candles.length > 0 ? candles : (showMockData || !loading ? mockCandles : []);

  // Ï£ºÎ¨∏ ÏÉÅÌÉú Í¥ÄÎ¶¨
  const [orderType, setOrderType] = useState<'Market' | 'Limit'>('Limit');
  const [orderSide, setOrderSide] = useState<'Buy' | 'Sell'>('Buy');
  const [orderPrice, setOrderPrice] = useState<string>(currentPrice.toString());
  const [orderQuantity, setOrderQuantity] = useState<string>('');
  const [isSubmitting, setIsSubmitting] = useState(false);
  
  // ÌÜµÍ≥Ñ Îç∞Ïù¥ÌÑ∞Í∞Ä nullÏù∏ Í≤ΩÏö∞ Í∏∞Î≥∏Í∞í ÏÑ§Ï†ï
  const displayStatistics = statistics ? {
    ...statistics,
    last_price: statistics.last_price || 50000000,
    price_change_24h: statistics.price_change_24h || 0,
    high_price_24h: statistics.high_price_24h || 50000000,
    low_price_24h: statistics.low_price_24h || 50000000,
    volume_24h: statistics.volume_24h || 0
  } : null;

  // Ï£ºÎ¨∏ Ï≤òÎ¶¨ Ìï®Ïàò
  const handleSubmitOrder = async () => {
    if (!orderQuantity || parseFloat(orderQuantity) <= 0) {
      alert('ÏàòÎüâÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
      return;
    }

    if (orderType === 'Limit' && (!orderPrice || parseFloat(orderPrice) <= 0)) {
      alert('ÏßÄÏ†ïÍ∞Ä Ï£ºÎ¨∏ÏóêÎäî Í∞ÄÍ≤©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
      return;
    }

    // ÏûîÍ≥† ÌôïÏù∏
    const qty = parseFloat(orderQuantity);
    const price = orderType === 'Market' ? currentPrice : parseFloat(orderPrice);

    if (orderSide === 'Buy') {
      const requiredAmount = qty * price;
      if (requiredAmount > balance.KRW) {
        alert(`ÏûîÍ≥†Í∞Ä Î∂ÄÏ°±Ìï©ÎãàÎã§. ÌïÑÏöî Í∏àÏï°: ${formatNumber(requiredAmount)} KRW`);
        return;
      }
    } else {
      if (qty > balance.BTC) {
        alert(`Î≥¥Ïú† BTCÍ∞Ä Î∂ÄÏ°±Ìï©ÎãàÎã§. Î≥¥Ïú†Îüâ: ${balance.BTC} BTC`);
        return;
      }
    }

    try {
      setIsSubmitting(true);
      const orderData = {
        symbol: 'BTC-KRW',
        side: orderSide,
        orderType: orderType,
        price: orderType === 'Market' ? undefined : price,
        quantity: qty,
      };

      console.log('üöÄ Ï£ºÎ¨∏ Ï†úÏ∂ú:', orderData);
      const result = await submitOrder(orderData);
      console.log('‚úÖ Ï£ºÎ¨∏ ÏÑ±Í≥µ:', result);

      // Ï£ºÎ¨∏ ÏÑ±Í≥µ Ïãú Ìèº Î¶¨ÏÖã
      setOrderQuantity('');
      if (orderType === 'Limit') {
        setOrderPrice(currentPrice.toString());
      }

      alert(`Ï£ºÎ¨∏Ïù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§!\nÏ£ºÎ¨∏ ID: ${result.order_id}`);
    } catch (err) {
      console.error('‚ùå Ï£ºÎ¨∏ Ïã§Ìå®:', err);
      alert(`Ï£ºÎ¨∏ Ïã§Ìå®: ${err instanceof Error ? err.message : 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}`);
    } finally {
      setIsSubmitting(false);
    }
  };

  // Ï£ºÎ¨∏ ÌÉÄÏûÖÏù¥ Î≥ÄÍ≤ΩÎê† Îïå Í∞ÄÍ≤© ÌïÑÎìú ÏóÖÎç∞Ïù¥Ìä∏
  React.useEffect(() => {
    if (orderType === 'Market') {
      setOrderPrice('');
    } else {
      setOrderPrice(currentPrice.toString());
    }
  }, [orderType, currentPrice]);

  // ÎîîÎ≤ÑÍπÖÏùÑ ÏúÑÌïú console.log Ï∂îÍ∞Ä
  console.log('üîç SimpleApp ÏÉÅÌÉú:', {
    loading,
    error,
    candlesLength: candles.length,
    executionsLength: executions.length,
    statistics,
    currentPrice
  });

  const containerStyle: React.CSSProperties = {
    minHeight: '100vh',
    backgroundColor: '#0c0f13',
    color: '#ffffff',
    fontFamily: 'Arial, sans-serif'
  };

  const headerStyle: React.CSSProperties = {
    backgroundColor: '#161a20',
    borderBottom: '1px solid #2b3139',
    padding: '16px 24px',
    display: 'flex',
    justifyContent: 'space-between',
    alignItems: 'center'
  };

  const titleStyle: React.CSSProperties = {
    fontSize: '24px',
    fontWeight: 'bold',
    color: '#3b82f6'
  };

  const priceStyle: React.CSSProperties = {
    fontSize: '20px',
    fontWeight: 'bold',
    color: '#02c076'
  };

  const balanceStyle: React.CSSProperties = {
    backgroundColor: '#1e2329',
    padding: '12px',
    borderRadius: '8px',
    fontSize: '14px'
  };

  const mainStyle: React.CSSProperties = {
    display: 'flex',
    height: 'calc(100vh - 80px)'
  };

  const leftPanelStyle: React.CSSProperties = {
    flex: '1',
    padding: '16px'
  };

  const rightPanelStyle: React.CSSProperties = {
    width: '320px',
    padding: '16px',
    borderLeft: '1px solid #2b3139'
  };

  const cardStyle: React.CSSProperties = {
    backgroundColor: '#161a20',
    border: '1px solid #2b3139',
    borderRadius: '8px',
    padding: '16px',
    marginBottom: '16px'
  };

  const chartPlaceholderStyle: React.CSSProperties = {
    ...cardStyle,
    height: '400px',
    display: 'flex',
    alignItems: 'center',
    justifyContent: 'center',
    textAlign: 'center',
    color: '#848e9c'
  };

  const buttonStyle: React.CSSProperties = {
    padding: '8px 16px',
    border: 'none',
    borderRadius: '4px',
    cursor: 'pointer',
    fontWeight: '500'
  };

  const buyButtonStyle: React.CSSProperties = {
    ...buttonStyle,
    backgroundColor: '#02c076',
    color: 'white',
    marginRight: '8px'
  };

  const sellButtonStyle: React.CSSProperties = {
    ...buttonStyle,
    backgroundColor: '#f84960',
    color: 'white'
  };

  const tabButtonStyle: React.CSSProperties = {
    padding: '8px 16px',
    border: 'none',
    background: 'transparent',
    color: '#848e9c',
    cursor: 'pointer',
    borderBottom: '2px solid transparent',
    fontSize: '14px',
    fontWeight: '500'
  };

  const activeTabButtonStyle: React.CSSProperties = {
    ...tabButtonStyle,
    color: '#ffffff',
    borderBottom: '2px solid #3b82f6'
  };

  const orderTypeButtonStyle: React.CSSProperties = {
    ...buttonStyle,
    backgroundColor: '#2b3139',
    color: '#c7c9cb',
    marginRight: '8px',
    fontSize: '12px'
  };

  const activeOrderTypeButtonStyle: React.CSSProperties = {
    ...orderTypeButtonStyle,
    backgroundColor: '#3b82f6',
    color: 'white'
  };

  const disabledButtonStyle: React.CSSProperties = {
    ...buttonStyle,
    backgroundColor: '#2b3139',
    color: '#848e9c',
    cursor: 'not-allowed',
    opacity: 0.6
  };

  const inputStyle: React.CSSProperties = {
    width: '100%',
    padding: '8px 12px',
    backgroundColor: '#161a20',
    border: '1px solid #2b3139',
    borderRadius: '4px',
    color: '#ffffff',
    marginBottom: '12px'
  };

  const formatNumber = (num: number) => {
    return new Intl.NumberFormat('ko-KR').format(num);
  };

  return (
    <div style={containerStyle}>
      {/* Header */}
      <header style={headerStyle}>
        <div style={{ display: 'flex', alignItems: 'center', gap: '24px' }}>
          <div>
            <h1 style={titleStyle}>üìà xTrader</h1>
            <div style={{ fontSize: '12px', color: '#848e9c' }}>Professional Trading Platform</div>
          </div>
          <div>
            <div style={{ fontSize: '12px', color: '#848e9c' }}>BTC-KRW</div>
            <div style={priceStyle}>
              {formatNumber(currentPrice)} KRW
              {displayStatistics && (
                <span style={{
                  fontSize: '14px',
                  color: displayStatistics.price_change_24h >= 0 ? '#02c076' : '#f84960',
                  marginLeft: '12px'
                }}>
                  {displayStatistics.price_change_24h >= 0 ? '+' : ''}{(displayStatistics.price_change_24h * 100).toFixed(2)}%
                </span>
              )}
            </div>
          </div>
        </div>

        <div style={balanceStyle}>
          <div>KRW: {formatNumber(balance.KRW)}</div>
          <div>BTC: {balance.BTC.toFixed(6)}</div>
        </div>
      </header>

      {/* Main Content */}
      <main style={mainStyle}>
        {/* Left Panel - Chart & History */}
        <div style={leftPanelStyle}>
          {/* Chart */}
          <div style={{...cardStyle, padding: 0}}>
            <div style={{ padding: '16px 16px 8px 16px' }}>
              <div style={{ fontSize: '18px', marginBottom: '8px', color: '#3b82f6' }}>üìä BTC-KRW Ïã§ÏãúÍ∞Ñ Ï∞®Ìä∏</div>
              <div style={{ fontSize: '14px', color: candles.length > 0 ? '#02c076' : '#fbbf24', marginBottom: '8px' }}>
                {loading && candles.length === 0 && !showMockData ? (
                  '‚è≥ Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...'
                ) : candles.length > 0 ? (
                  `‚úÖ Ïã§ÏãúÍ∞Ñ ${chartCandles.length}Í∞ú Ï∫îÎì§ Îç∞Ïù¥ÌÑ∞ Î°úÎìúÎê®`
                ) : chartCandles.length > 0 ? (
                  `üîÑ Mock ${chartCandles.length}Í∞ú Ï∫îÎì§ Îç∞Ïù¥ÌÑ∞ ÌëúÏãú Ï§ë`
                ) : (
                  '‚ùå Ï∞®Ìä∏ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§'
                )}
              </div>
            </div>

            {chartCandles.length > 0 ? (
              <TradingViewChart
                data={chartCandles}
                width={800}
                height={300}
              />
            ) : (
              <div style={{
                height: '300px',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                color: '#848e9c'
              }}>
                {loading && !showMockData ? 'Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...' : 'Ï∞®Ìä∏ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...'}
              </div>
            )}

            <div style={{ padding: '8px 16px 16px 16px', borderTop: '1px solid #2b3139' }}>
              <div style={{ fontSize: '12px', color: '#848e9c' }}>
                Í≥†Í∞Ä: ‚Ç©{formatNumber(Math.max(...chartCandles.map(c => c.high || 0)))}<br/>
                Ï†ÄÍ∞Ä: ‚Ç©{formatNumber(Math.min(...chartCandles.map(c => c.low || 0)))}<br/>
                Í±∞ÎûòÎüâ: {chartCandles.reduce((sum, c) => sum + (c.volume || 0), 0).toLocaleString()}
              </div>
              <div style={{ fontSize: '10px', color: '#6b7280', marginTop: '8px' }}>
                {candles.length > 0 ? 'üéØ TradingView Ïã§ÏãúÍ∞Ñ Ï∫îÎì§Ïä§Ìã± Ï∞®Ìä∏' : 'üß™ TradingView ÌÖåÏä§Ìä∏Ïö© Mock Ï∞®Ìä∏'}
              </div>
            </div>
          </div>

          {/* Trade History */}
          <div style={cardStyle}>
            <h3 style={{ marginTop: 0, marginBottom: '16px' }}>ÏµúÍ∑º Ï≤¥Í≤∞ ÎÇ¥Ïó≠</h3>
            {executions.length > 0 ? (
              <div>
                {executions.slice(0, 5).map((execution, index) => (
                  <div key={index} style={{
                    display: 'flex',
                    justifyContent: 'space-between',
                    padding: '8px 0',
                    borderBottom: index < 4 ? '1px solid #2b3139' : 'none',
                    fontSize: '12px'
                  }}>
                    <span style={{ color: execution.side === 'Buy' ? '#02c076' : '#f84960' }}>
                      {execution.side === 'Buy' ? 'Îß§Ïàò' : 'Îß§ÎèÑ'}
                    </span>
                    <span>‚Ç©{formatNumber(execution.price)}</span>
                    <span>{execution.quantity}</span>
                    <span style={{ color: '#848e9c' }}>
                      {new Date(execution.timestamp * 1000).toLocaleTimeString()}
                    </span>
                  </div>
                ))}
              </div>
            ) : (
              <div style={{ color: '#848e9c', textAlign: 'center', padding: '20px 0' }}>
                {loading ? 'Ï≤¥Í≤∞ ÎÇ¥Ïó≠ÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë...' : 'ÏïÑÏßÅ Ï≤¥Í≤∞Îêú Í±∞ÎûòÍ∞Ä ÏóÜÏäµÎãàÎã§.'}
              </div>
            )}
          </div>
        </div>

        {/* Right Panel - Trading Form & Order Book */}
        <div style={rightPanelStyle}>
          {/* Trading Form */}
          <div style={cardStyle}>
            {/* Îß§Ïàò/Îß§ÎèÑ ÌÉ≠ */}
            <div style={{ display: 'flex', marginBottom: '16px', borderBottom: '1px solid #2b3139' }}>
              <button
                style={orderSide === 'Buy' ? activeTabButtonStyle : tabButtonStyle}
                onClick={() => setOrderSide('Buy')}
              >
                üí∞ Îß§Ïàò
              </button>
              <button
                style={orderSide === 'Sell' ? activeTabButtonStyle : tabButtonStyle}
                onClick={() => setOrderSide('Sell')}
              >
                üí∏ Îß§ÎèÑ
              </button>
            </div>

            {/* Ï£ºÎ¨∏ ÌÉÄÏûÖ ÏÑ†ÌÉù */}
            <div style={{ marginBottom: '16px' }}>
              <div style={{ fontSize: '14px', color: '#c7c9cb', marginBottom: '8px' }}>Ï£ºÎ¨∏ ÌÉÄÏûÖ</div>
              <div style={{ display: 'flex' }}>
                <button
                  style={orderType === 'Limit' ? activeOrderTypeButtonStyle : orderTypeButtonStyle}
                  onClick={() => setOrderType('Limit')}
                >
                  ÏßÄÏ†ïÍ∞Ä
                </button>
                <button
                  style={orderType === 'Market' ? activeOrderTypeButtonStyle : orderTypeButtonStyle}
                  onClick={() => setOrderType('Market')}
                >
                  ÏãúÏû•Í∞Ä
                </button>
              </div>
            </div>

            {/* Í∞ÄÍ≤© ÏûÖÎ†• (ÏßÄÏ†ïÍ∞ÄÏùº ÎïåÎßå) */}
            {orderType === 'Limit' && (
              <div style={{ marginBottom: '12px' }}>
                <label style={{ fontSize: '14px', color: '#c7c9cb', display: 'block', marginBottom: '4px' }}>
                  Í∞ÄÍ≤© (KRW)
                </label>
                <input
                  type="number"
                  placeholder="Í∞ÄÍ≤©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                  style={inputStyle}
                  value={orderPrice}
                  onChange={(e) => setOrderPrice(e.target.value)}
                />
              </div>
            )}

            {/* ÏãúÏû•Í∞Ä Í∞ÄÍ≤© ÌëúÏãú */}
            {orderType === 'Market' && (
              <div style={{ marginBottom: '12px' }}>
                <div style={{ fontSize: '14px', color: '#c7c9cb', marginBottom: '4px' }}>
                  ÏòàÏÉÅ Ï≤¥Í≤∞Í∞Ä (KRW)
                </div>
                <div style={{
                  padding: '8px 12px',
                  backgroundColor: '#1e2329',
                  border: '1px solid #2b3139',
                  borderRadius: '4px',
                  color: orderSide === 'Buy' ? '#02c076' : '#f84960',
                  fontWeight: 'bold'
                }}>
                  ‚âà {formatNumber(currentPrice)} KRW
                </div>
              </div>
            )}

            {/* ÏàòÎüâ ÏûÖÎ†• */}
            <div style={{ marginBottom: '12px' }}>
              <label style={{ fontSize: '14px', color: '#c7c9cb', display: 'block', marginBottom: '4px' }}>
                ÏàòÎüâ (BTC)
              </label>
              <input
                type="number"
                placeholder="ÏàòÎüâÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                style={inputStyle}
                value={orderQuantity}
                onChange={(e) => setOrderQuantity(e.target.value)}
                step="0.000001"
                min="0"
              />
            </div>

            {/* ÏòàÏÉÅ Ï¥ùÏï° */}
            <div style={{ marginBottom: '16px', padding: '8px', backgroundColor: '#1e2329', borderRadius: '4px' }}>
              <div style={{ fontSize: '12px', color: '#c7c9cb' }}>
                ÏòàÏÉÅ Ï¥ùÏï°: {orderQuantity && parseFloat(orderQuantity) > 0 ?
                  `${formatNumber((parseFloat(orderQuantity) * (orderType === 'Market' ? currentPrice : parseFloat(orderPrice || '0'))))} KRW` :
                  '0 KRW'}
              </div>
              <div style={{ fontSize: '12px', color: '#848e9c', marginTop: '4px' }}>
                ÏàòÏàòÎ£å (0.1%): {orderQuantity && parseFloat(orderQuantity) > 0 ?
                  `‚âà ${formatNumber((parseFloat(orderQuantity) * (orderType === 'Market' ? currentPrice : parseFloat(orderPrice || '0')) * 0.001))} KRW` :
                  '0 KRW'}
              </div>
              <div style={{ fontSize: '12px', color: '#848e9c', marginTop: '2px' }}>
                {orderSide === 'Buy' ? 'ÌïÑÏöî KRW: ' : 'Î≥¥Ïú† BTC: '}
                {orderSide === 'Buy' ? `${formatNumber(balance.KRW)} KRW` : `${balance.BTC} BTC`}
              </div>
            </div>

            {/* Ï£ºÎ¨∏ Î≤ÑÌäº */}
            <button
              style={isSubmitting || !orderQuantity || parseFloat(orderQuantity) <= 0 ?
                disabledButtonStyle :
                (orderSide === 'Buy' ? buyButtonStyle : sellButtonStyle)}
              onClick={handleSubmitOrder}
              disabled={isSubmitting || !orderQuantity || parseFloat(orderQuantity) <= 0}
            >
              {isSubmitting ?
                '‚è≥ Ï£ºÎ¨∏ Ï≤òÎ¶¨ Ï§ë...' :
                `${orderSide === 'Buy' ? 'üí∞ Îß§Ïàò' : 'üí∏ Îß§ÎèÑ'} ${orderType === 'Market' ? '(ÏãúÏû•Í∞Ä)' : '(ÏßÄÏ†ïÍ∞Ä)'}`}
            </button>
          </div>

          {/* Order Book */}
          <div style={cardStyle}>
            <h3 style={{ marginTop: 0, marginBottom: '16px' }}>Ìò∏Í∞ÄÏ∞Ω</h3>

            {orderBook ? (
              <div style={{ fontSize: '12px', fontFamily: 'monospace' }}>
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '8px', marginBottom: '8px', color: '#848e9c' }}>
                  <div>Í∞ÄÍ≤©</div>
                  <div style={{ textAlign: 'right' }}>ÏàòÎüâ</div>
                  <div style={{ textAlign: 'right' }}>ÎàÑÏ†Å</div>
                </div>

                {/* Ask (Îß§ÎèÑ) - ÎÜíÏùÄ Í∞ÄÍ≤©Î∂ÄÌÑ∞ */}
                {orderBook.asks.slice(0, 5).reverse().map((ask, i) => {
                  const cumulative = orderBook.asks.slice(0, orderBook.asks.indexOf(ask) + 1)
                    .reduce((sum, a) => sum + a.volume, 0);
                  return (
                    <div key={`ask-${i}`} style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '8px', marginBottom: '2px', padding: '2px 0' }}>
                      <div style={{ color: '#f84960' }}>{formatNumber(ask.price)}</div>
                      <div style={{ textAlign: 'right', color: '#ffffff' }}>{ask.volume.toFixed(6)}</div>
                      <div style={{ textAlign: 'right', color: '#c7c9cb' }}>{cumulative.toFixed(6)}</div>
                    </div>
                  );
                })}

                {/* Spread */}
                <div style={{ textAlign: 'center', padding: '8px 0', color: '#848e9c', borderTop: '1px solid #2b3139', borderBottom: '1px solid #2b3139', margin: '8px 0' }}>
                  {orderBook.asks.length > 0 && orderBook.bids.length > 0 ?
                    `Ïä§ÌîÑÎ†àÎìú: ${formatNumber(orderBook.asks[0].price - orderBook.bids[0].price)}` :
                    'Ïä§ÌîÑÎ†àÎìú: -'}
                </div>

                {/* Bid (Îß§Ïàò) - ÎÜíÏùÄ Í∞ÄÍ≤©Î∂ÄÌÑ∞ */}
                {orderBook.bids.slice(0, 5).map((bid, i) => {
                  const cumulative = orderBook.bids.slice(0, i + 1)
                    .reduce((sum, b) => sum + b.volume, 0);
                  return (
                    <div key={`bid-${i}`} style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '8px', marginBottom: '2px', padding: '2px 0' }}>
                      <div style={{ color: '#02c076' }}>{formatNumber(bid.price)}</div>
                      <div style={{ textAlign: 'right', color: '#ffffff' }}>{bid.volume.toFixed(6)}</div>
                      <div style={{ textAlign: 'right', color: '#c7c9cb' }}>{cumulative.toFixed(6)}</div>
                    </div>
                  );
                })}
              </div>
            ) : (
              <div style={{ color: '#848e9c', textAlign: 'center', padding: '20px 0' }}>
                {loading ? 'Ìò∏Í∞ÄÏ∞Ω Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...' : 'Ìò∏Í∞ÄÏ∞Ω Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.'}
              </div>
            )}
          </div>
        </div>
      </main>

      {/* Status Bar */}
      <div style={{ position: 'fixed', bottom: '16px', right: '16px' }}>
        <div style={{
          padding: '8px 12px',
          backgroundColor: '#1e2329',
          border: '1px solid #2b3139',
          borderRadius: '4px',
          fontSize: '12px',
          color: loading ? '#ffa500' : error ? '#f84960' : '#02c076'
        }}>
          {loading ? '‚è≥ Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...' : error ? `‚ùå ${error}` : '‚úÖ Î∞±ÏóîÎìú Ïó∞Í≤∞Îê® (Ìè¨Ìä∏ 7000)'}
        </div>
      </div>
    </div>
  );
};

export default SimpleApp;